<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>마이페이지 | 분리수거 도우미</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      /* 기존 style.css 느낌 유지하면서 마이페이지 전용 스타일 추가 */
      .mypage-container {
        display: flex;
        gap: 30px;
        padding: 40px;
      }

      .profile-card {
        flex: 0 0 280px;
        background: #f9fafb;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
        padding: 30px 20px;
      }

      .profile-card img {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 3px solid #4caf50;
        margin-bottom: 15px;
      }

      .profile-card h2 {
        margin-bottom: 8px;
      }

      .profile-card p {
        color: #555;
        margin-bottom: 20px;
      }

      .logout-btn {
        background: #f44336;
        color: white;
        border: none;
        padding: 10px 18px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
      }

      .info-section {
        flex: 1;
      }

      .info-box {
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 25px;
        padding: 25px;
      }

      .info-box h3 {
        border-bottom: 2px solid #4caf50;
        padding-bottom: 8px;
        margin-bottom: 15px;
        color: #333;
      }

      .info-list li {
        list-style: none;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
      }

      .info-list li:last-child {
        border: none;
      }
    </style>
  </head>
  <body>
    <!-- ✅ 헤더 -->
    <header>
      <div class="logo">
        <img
          src="image/home/logo.png"
          alt="분리수거 도우미 로고"
          id="Logo"
          style="cursor: pointer"
          onclick="location.href='index.html'"
        />
      </div>
      <div class="header-buttons">
        <button class="logout-btn" id="logoutBtn">로그아웃</button>
      </div>
    </header>

    <main class="mypage-container">
      <!-- 왼쪽 프로필 -->
      <div class="profile-card">
        <img src="image/profile_default.png" alt="프로필 이미지" />
        <h2 id="userName">사용자</h2>
        <p>분리수거 도우미 회원</p>
        <p><strong>포인트:</strong> <span id="userPoint">1250</span>P</p>
        <button class="logout-btn" id="logoutBtn2">로그아웃</button>
      </div>

      <!-- 오른쪽 정보 -->
      <div class="info-section">
        <div class="info-box">
          <h3>내 정보</h3>
          <ul class="info-list">
            <li><strong>아이디:</strong> <span id="userId"></span></li>
            <li>
              <strong>가입일:</strong> <span id="joinDate">2025-11-3</span>
            </li>
            <li>
              <strong>최근 로그인:</strong> <span id="lastLogin">오늘</span>
            </li>
          </ul>
        </div>

        <div class="info-box">
          <h3>최근 활동</h3>
          <ul class="info-list" id="recentList">
            <li>커뮤니티 글 작성: “분리수거 꿀팁 공유!”</li>
            <li>포인트 상점에서 “재활용 봉투” 교환</li>
            <li>게임 “분리수거 챌린지” 2등 달성</li>
          </ul>
        </div>
      </div>
    </main>

    <script>
      (async function () {
        const userId = localStorage.getItem('userId');
        if (!userId) {
          alert('로그인이 필요합니다.');
          location.href = 'login.html';
          return;
        }

        try {
          const res = await fetch(
            `/user/me?user_id=${encodeURIComponent(userId)}`
          );
          if (!res.ok) throw new Error(await res.text());
          const data = await res.json();

          // 기본 정보 표시
          document.getElementById('userName').textContent =
            data.nickname || '사용자';
          document.getElementById('userId').textContent = data.email || '-';
          document.getElementById('userPoint').textContent = data.point ?? 0;
          document.getElementById('joinDate').textContent =
            data.joined_at || '-';
          document.getElementById('lastLogin').textContent =
            data.last_login || '-';

          // 최근 활동 표시
          const list = document.getElementById('recentList');
          list.innerHTML = '';
          if (data.recent_posts && data.recent_posts.length > 0) {
            data.recent_posts.forEach((p) => {
              const li = document.createElement('li');
              li.textContent = `커뮤니티 글: “${p.title}” (${p.created_at})`;
              list.appendChild(li);
            });
          } else {
            const li = document.createElement('li');
            li.textContent = '최근 활동이 없습니다.';
            list.appendChild(li);
          }

          // 로그아웃 기능
          const logout = () => {
            localStorage.removeItem('userId');
            localStorage.removeItem('loginUser');
            localStorage.removeItem('nickname');
            alert('로그아웃되었습니다.');
            location.href = 'index.html';
          };
          document
            .getElementById('logoutBtn')
            .addEventListener('click', logout);
          document
            .getElementById('logoutBtn2')
            .addEventListener('click', logout);
        } catch (err) {
          console.error(err);
          alert('마이페이지 데이터를 불러오는 중 오류가 발생했습니다.');
        }
      })();
    </script>
  </body>
</html>
